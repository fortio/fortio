# testscript framework tests for fortio's main binary / command line
# Eventually we can convert most of Webtest.sh to here (except parts specifically about testing the Docker image)

# Basic usage test
!fortio
!stdout .
stderr 'Missing command argument'

# (short) version
fortio version
stdout '^dev$'
!stderr .

# (long) version
fortio buildinfo
stdout '^dev  go'
stdout 'path	fortio.org/fortio'
!stderr .

# Content-Type override through headers
fortio curl -H 'content-TYPE: foo/bar' -H 'xyz: bar blah' https://debug.fortio.org/test-path
stderr 'HTTP/1.1 200 OK'
stdout 'Xyz: bar blah'
stdout 'Content-Type: foo/bar'
stdout 'POST /test-path HTTP/1.1'

# HTTP multi proxy to run (-M flag)
fortio curl -M '8088 http://fortio-c1-http:8080 http://fortio-c2-http:8080' https://debug.fortio.org/test-path
stderr 'HTTP/1.1 200 OK'
stdout 'GET /test-path HTTP/1.1'

# TCP proxies to run (-P flag)
fortio curl -P '8089 fortio-c-tcp:8078' -P '8090 fortio-c1-http:8080' https://debug.fortio.org/test-path
stderr 'HTTP/1.1 200 OK'
stdout 'GET /test-path HTTP/1.1'
